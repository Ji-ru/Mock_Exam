<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Nutritionist/Dietitian Mock Exam</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto",
          sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 12px;
        color: #1f2937;
      }

      .container {
        max-width: 900px;
        margin: 0 auto;
      }

      /* Header */
      .header {
        background: rgba(255, 255, 255, 0.98);
        backdrop-filter: blur(10px);
        border-radius: 16px;
        padding: 16px;
        margin-bottom: 16px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
        animation: slideDown 0.5s ease;
      }

      @keyframes slideDown {
        from {
          opacity: 0;
          transform: translateY(-20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .header-top {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
      }

      .header h1 {
        font-size: 18px;
        font-weight: 700;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      /* Domain Tabs */
      .domain-tabs {
        display: flex;
        gap: 8px;
        margin-top: 12px;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }

      .domain-tabs::-webkit-scrollbar {
        height: 4px;
      }

      .domain-tabs::-webkit-scrollbar-track {
        background: #f3f4f6;
        border-radius: 4px;
      }

      .domain-tabs::-webkit-scrollbar-thumb {
        background: #667eea;
        border-radius: 4px;
      }

      .domain-tab {
        flex: 1;
        min-width: 120px;
        padding: 10px 16px;
        border: 2px solid #e5e7eb;
        border-radius: 10px;
        background: white;
        color: #6b7280;
        font-weight: 600;
        font-size: 13px;
        cursor: pointer;
        transition: all 0.3s ease;
        white-space: nowrap;
        text-align: center;
      }

      .domain-tab:active {
        transform: scale(0.97);
      }

      .domain-tab.active {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-color: transparent;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
      }

      .timer-badge {
        display: flex;
        align-items: center;
        gap: 6px;
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        padding: 8px 12px;
        border-radius: 10px;
        color: white;
        font-weight: 700;
        font-size: 14px;
        box-shadow: 0 4px 15px rgba(240, 147, 251, 0.3);
      }

      /* Progress Bar */
      .progress-section {
        background: #f3f4f6;
        border-radius: 10px;
        padding: 8px;
      }

      .progress-info {
        display: flex;
        justify-content: space-between;
        font-size: 12px;
        color: #6b7280;
        margin-bottom: 6px;
        font-weight: 600;
      }

      .progress-bar {
        height: 8px;
        background: #e5e7eb;
        border-radius: 10px;
        overflow: hidden;
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        border-radius: 10px;
        transition: width 0.3s ease;
      }

      /* Navigation Panel */
      .nav-panel {
        background: rgba(255, 255, 255, 0.98);
        border-radius: 16px;
        padding: 16px;
        margin-bottom: 16px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
        max-height: 400px;
        overflow-y: auto;
      }

      .nav-panel.hide {
        display: none;
      }

      .nav-grid {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 8px;
      }

      .nav-grid button {
        aspect-ratio: 1;
        border: 2px solid #e5e7eb;
        border-radius: 10px;
        background: white;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        color: #6b7280;
        transition: all 0.2s ease;
      }

      .nav-grid button:active {
        transform: scale(0.95);
      }

      .nav-grid button.answered {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-color: transparent;
      }

      .nav-grid button.current {
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
      }

      /* Question Area */
      .question-area {
        background: rgba(255, 255, 255, 0.98);
        backdrop-filter: blur(10px);
        border-radius: 16px;
        padding: 20px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
        margin-bottom: 16px;
        animation: fadeIn 0.4s ease;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
      }

      @keyframes slideInUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .question-number {
        display: inline-block;
        font-size: 12px;
        font-weight: 600;
        color: #6b7280;
        background: #f3f4f6;
        padding: 6px 12px;
        border-radius: 8px;
        margin-bottom: 16px;
      }

      .question-text {
        font-size: 17px;
        font-weight: 600;
        color: #111827;
        line-height: 1.6;
        margin-bottom: 20px;
      }

      /* Options */
      .options {
        display: flex;
        flex-direction: column;
        gap: 10px;
        margin-bottom: 20px;
      }

      .option-label {
        display: flex;
        align-items: flex-start;
        padding: 14px;
        border: 2px solid #e5e7eb;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.2s ease;
        background: white;
        -webkit-tap-highlight-color: transparent;
      }

      .option-label:active {
        transform: scale(0.98);
      }

      .option-label input[type="radio"] {
        width: 20px;
        height: 20px;
        margin-right: 12px;
        margin-top: 2px;
        cursor: pointer;
        flex-shrink: 0;
        accent-color: #667eea;
      }

      .option-label.selected {
        border-color: #667eea;
        background: linear-gradient(
          135deg,
          rgba(102, 126, 234, 0.1) 0%,
          rgba(118, 75, 162, 0.1) 100%
        );
      }

      .option-text {
        flex: 1;
        font-size: 15px;
        line-height: 1.5;
      }

      /* Controls */
      .controls {
        display: flex;
        gap: 8px;
        padding-top: 20px;
        border-top: 2px solid #f3f4f6;
      }

      .controls button {
        flex: 1;
        padding: 14px;
        border: none;
        border-radius: 12px;
        cursor: pointer;
        font-weight: 600;
        font-size: 14px;
        transition: all 0.2s ease;
        -webkit-tap-highlight-color: transparent;
      }

      .controls button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .controls button:not(:disabled):active {
        transform: scale(0.97);
      }

      .btn-prev {
        background: #f3f4f6;
        color: #374151;
      }

      .btn-next {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
      }

      .btn-submit {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        color: white;
        flex: 2;
      }

      /* Results */
      .result-summary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 24px;
        border-radius: 16px;
        text-align: center;
        margin-bottom: 16px;
        box-shadow: 0 10px 40px rgba(102, 126, 234, 0.4);
      }

      .result-summary h2 {
        font-size: 24px;
        margin-bottom: 12px;
      }

      .result-summary .score {
        font-size: 48px;
        font-weight: 700;
        margin: 12px 0;
      }

      .result-summary .percentage {
        font-size: 18px;
        margin-bottom: 16px;
        opacity: 0.95;
      }

      .btn-try-again {
        background: white;
        color: #667eea;
        padding: 12px 24px;
        border: none;
        border-radius: 10px;
        font-weight: 600;
        font-size: 15px;
        cursor: pointer;
        transition: all 0.2s ease;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        animation: pulse 2s ease-in-out infinite;
      }

      .btn-try-again:hover {
        transform: scale(1.05);
        box-shadow: 0 4px 20px rgba(102, 126, 234, 0.3);
      }

      .btn-try-again:active {
        transform: scale(0.97);
        animation: none;
      }

      /* Pagination */
      .pagination {
        background: #f3f4f6;
        padding: 12px;
        border-radius: 12px;
        margin-bottom: 16px;
      }

      .pagination-info {
        font-size: 13px;
        font-weight: 600;
        color: #6b7280;
        text-align: center;
        margin-bottom: 8px;
      }

      .pagination-controls {
        display: flex;
        gap: 8px;
        align-items: center;
      }

      .pagination-controls button {
        flex: 1;
        padding: 10px;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        font-size: 13px;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .pagination-controls button:disabled {
        background: #e5e7eb;
        color: #9ca3af;
        cursor: not-allowed;
      }

      .pagination-controls button:not(:disabled) {
        background: #667eea;
        color: white;
      }

      .pagination-controls button:not(:disabled):active {
        transform: scale(0.97);
      }

      .page-indicator {
        padding: 10px 16px;
        background: white;
        border-radius: 8px;
        font-weight: 600;
        font-size: 13px;
        text-align: center;
        white-space: nowrap;
      }

      /* Review Items */
      .review-container {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .review-item {
        background: white;
        border-radius: 12px;
        padding: 16px;
        border: 2px solid #e5e7eb;
        width: 100%;
        animation: slideInUp 0.4s ease forwards;
        opacity: 0;
      }

      .review-item:nth-child(1) {
        animation-delay: 0.05s;
      }
      .review-item:nth-child(2) {
        animation-delay: 0.1s;
      }
      .review-item:nth-child(3) {
        animation-delay: 0.15s;
      }
      .review-item:nth-child(4) {
        animation-delay: 0.2s;
      }
      .review-item:nth-child(5) {
        animation-delay: 0.25s;
      }
      .review-item:nth-child(6) {
        animation-delay: 0.3s;
      }

      .review-item.correct {
        border-color: #10b981;
        background: linear-gradient(
          135deg,
          rgba(16, 185, 129, 0.05) 0%,
          rgba(5, 150, 105, 0.05) 100%
        );
      }

      .review-item.incorrect {
        border-color: #ef4444;
        background: linear-gradient(
          135deg,
          rgba(239, 68, 68, 0.05) 0%,
          rgba(220, 38, 38, 0.05) 100%
        );
      }

      .review-question {
        font-weight: 600;
        margin-bottom: 12px;
        font-size: 15px;
        line-height: 1.5;
      }

      .review-choice {
        margin: 8px 0;
        font-size: 14px;
        line-height: 1.5;
      }

      .review-choice.correct-answer {
        color: #10b981;
        font-weight: 600;
      }

      .answer-badge {
        display: inline-block;
        padding: 6px 12px;
        border-radius: 8px;
        font-weight: 600;
        font-size: 13px;
        margin-top: 12px;
      }

      .answer-badge.correct {
        background: #10b981;
        color: white;
      }

      .answer-badge.incorrect {
        background: #ef4444;
        color: white;
      }

      /* Tablet and Desktop */
      @media (min-width: 768px) {
        body {
          padding: 20px;
        }

        .container {
          max-width: 100%;
          padding: 0 20px;
        }

        .header {
          padding: 20px;
          max-width: 1400px;
          margin: 0 auto 20px;
        }

        .header h1 {
          font-size: 24px;
        }

        .timer-badge {
          font-size: 16px;
          padding: 10px 16px;
        }

        .nav-panel {
          max-height: 400px;
          overflow-y: auto;
          padding: 20px;
          margin-bottom: 20px;
          max-width: 1400px;
          margin: 0 auto 20px;
        }

        .nav-grid {
          grid-template-columns: repeat(10, 1fr);
        }

        .question-area {
          padding: 28px;
          max-width: 1400px;
          margin: 0 auto;
        }

        .question-text {
          font-size: 19px;
        }

        .option-text {
          font-size: 16px;
        }

        .result-summary {
          padding: 32px;
        }

        .result-summary h2 {
          font-size: 32px;
        }

        .result-summary .score {
          font-size: 64px;
        }

        .review-container {
          display: grid;
          grid-template-columns: repeat(2, 1fr);
          gap: 16px;
        }

        .review-item {
          width: 100%;
        }
      }

      @media (min-width: 1200px) {
        .review-container {
          grid-template-columns: repeat(3, 1fr);
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Header -->
      <div class="header">
        <div class="header-top">
          <h1>🥗 Mock Exam</h1>
          <div class="timer-badge">
            <span>⏱️</span>
            <span id="timer">02:00:00</span>
          </div>
        </div>
        <!-- domain tabs -->
        <div class="domain-tabs">
          <button
            class="domain-tab active"
            onclick="switchDomain('nutrition_exam_domain1.json', 0)"
          >
           IR Domain I
          </button>
          <button
            class="domain-tab"
            onclick="switchDomain('nutrition_exam_domain2.json', 1)"
          >
            IR Domain II
          </button>
          <button
            class="domain-tab"
            onclick="switchDomain('nutrition_exam_domain3&4.json', 2)"
          >
            IR Domain III & IV
          </button>
          <button
            class="domain-tab"
            onclick="switchDomain('nutrition_CPHN.json', 3)"
          >
            CPHN
          </button>
        </div>

        <div class="progress-section">
          <div class="progress-info">
            <span>Progress</span>
            <span id="progressText">0/0</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
          </div>
        </div>
      </div>

      <!-- Navigation Panel -->
      <div class="nav-panel" id="navPanel">
        <div class="nav-grid" id="navGrid"></div>
      </div>

      <!-- Question Area -->
      <div class="question-area" id="questionArea"></div>
    </div>
    <script>
      let questions = [];
      let current = 0;
      let answers = [];
      let remaining = 2 * 60 * 60;
      let timerInterval;
      let currentResultPage = 0;
      const RESULTS_PER_PAGE = 50;

      // ✅ NEW: track domains
      const domainTabs = document.querySelectorAll(".domain-tab");

      // Load default domain on page load
      switchDomain("nutrition_exam_domain1.json", 0);

      function switchDomain(file, tabIndex) {
        // Reset current domain state
        current = 0;
        answers = [];
        questions = [];

        // Update active tab styling
        domainTabs.forEach((tab) => tab.classList.remove("active"));
        domainTabs[tabIndex].classList.add("active");

        // Load questions from the file
        fetch(file)
          .then((res) => res.json())
          .then((data) => {
            questions = data;
            answers = new Array(questions.length).fill(null);
            loadNav();
            showQuestion(0);
          })
          .catch((err) => console.error("Error loading questions:", err));
      }

      function formatTime(sec) {
        const h = Math.floor(sec / 3600)
          .toString()
          .padStart(2, "0");
        const m = Math.floor((sec % 3600) / 60)
          .toString()
          .padStart(2, "0");
        const s = (sec % 60).toString().padStart(2, "0");
        return `${h}:${m}:${s}`;
      }

      function updateTimer() {
        document.getElementById("timer").innerText = formatTime(remaining);
        if (remaining <= 0) {
          clearInterval(timerInterval);
          submitExam();
        }
        remaining--;
      }

      timerInterval = setInterval(updateTimer, 1000);

      function updateProgress() {
        const answered = answers.filter((a) => a !== null).length;
        const percentage = (answered / questions.length) * 100;
        document.getElementById("progressFill").style.width = percentage + "%";
        document.getElementById(
          "progressText"
        ).innerText = `${answered}/${questions.length}`;
      }

      function loadNav() {
        const grid = document.getElementById("navGrid");
        grid.innerHTML = "";
        for (let i = 0; i < questions.length; i++) {
          const btn = document.createElement("button");
          btn.innerText = i + 1;
          btn.onclick = () => showQuestion(i);
          if (answers[i] !== null) btn.classList.add("answered");
          if (i === current) btn.classList.add("current");
          grid.appendChild(btn);
        }
        updateProgress();
      }

      function showQuestion(index) {
        current = index;
        const q = questions[index];
        const area = document.getElementById("questionArea");

        area.innerHTML = `
      <div class="question-number">Question ${index + 1} of ${
          questions.length
        }</div>
      <div class="question-text">${q.q}</div>
    `;

        const opts = document.createElement("div");
        opts.className = "options";
        q.choices.forEach((c, i) => {
          const label = document.createElement("label");
          label.className = "option-label";
          if (answers[index] === i) label.classList.add("selected");
          label.innerHTML = `
        <input type="radio" name="q${index}" value="${i}" ${
            answers[index] === i ? "checked" : ""
          }>
        <span class="option-text">${c}</span>
      `;
          label.onclick = () => {
            document
              .querySelectorAll(".option-label")
              .forEach((l) => l.classList.remove("selected"));
            label.classList.add("selected");
          };
          opts.appendChild(label);
        });
        area.appendChild(opts);

        const controls = document.createElement("div");
        controls.className = "controls";
        controls.innerHTML = `
      <button class="btn-prev" ${
        index === 0 ? "disabled" : ""
      } onclick="showQuestion(${index - 1})">
        ← Prev
      </button>
      <button class="btn-next" ${
        index === questions.length - 1 ? "disabled" : ""
      } onclick="saveAnswer();showQuestion(${index + 1})">
        Next →
      </button>
      <button class="btn-submit" onclick="saveAnswer();submitExam()">
        Submit
      </button>
    `;
        area.appendChild(controls);

        loadNav();
      }

      function saveAnswer() {
        const radios = document.getElementsByName("q" + current);
        radios.forEach((r) => {
          if (r.checked) answers[current] = parseInt(r.value);
        });
        loadNav();
      }

      function submitExam() {
        clearInterval(timerInterval);
        let score = 0;
        questions.forEach((q, i) => {
          if (answers[i] === q.answer) score++;
        });

        currentResultPage = 0;
        showResultPage(score);
        document.getElementById("navPanel").classList.add("hide");
      }

      function showResultPage(score) {
        const area = document.getElementById("questionArea");
        const percentage = Math.round((score / questions.length) * 100);
        const totalPages = Math.ceil(questions.length / RESULTS_PER_PAGE);
        const startIdx = currentResultPage * RESULTS_PER_PAGE;
        const endIdx = Math.min(startIdx + RESULTS_PER_PAGE, questions.length);

        area.innerHTML = `
      <div class="result-summary">
        <h2>🎉 Exam Completed!</h2>
        <div class="score">${score}/${questions.length}</div>
        <div class="percentage">${percentage}% Correct</div>
        <button class="btn-try-again" onclick="tryAgain()">
          <span>🔄</span>
          <span>Try Again</span>
        </button>
      </div>
      <div class="review-container"></div>
      <div class="pagination">
        <div class="pagination-info">
          Showing ${startIdx + 1}-${endIdx} of ${questions.length} questions
        </div>
        <div class="pagination-controls">
          <button onclick="changePage(-1)" ${
            currentResultPage === 0 ? "disabled" : ""
          }>
            ← Previous
          </button>
          <div class="page-indicator">
            Page ${currentResultPage + 1}/${totalPages}
          </div>
          <button onclick="changePage(1)" ${
            currentResultPage === totalPages - 1 ? "disabled" : ""
          }>
            Next →
          </button>
        </div>
      </div>
    `;

        const container = area.querySelector(".review-container");
        for (let i = startIdx; i < endIdx; i++) {
          const q = questions[i];
          const div = document.createElement("div");
          div.className = `review-item ${
            answers[i] === q.answer ? "correct" : "incorrect"
          }`;
          div.innerHTML = `<div class="review-question">${i + 1}. ${q.q}</div>`;
          q.choices.forEach((c, idx) => {
            const checked = answers[i] === idx ? "✓ " : "";
            const className =
              idx === q.answer
                ? "review-choice correct-answer"
                : "review-choice";
            div.innerHTML += `<div class="${className}">${checked}${c}</div>`;
          });
          if (answers[i] === q.answer) {
            div.innerHTML += `<div class="answer-badge correct">✓ Correct</div>`;
          } else {
            div.innerHTML += `<div class="answer-badge incorrect">✗ Incorrect</div>`;
          }
          container.appendChild(div);
        }
      }

      function changePage(direction) {
        currentResultPage += direction;
        let score = 0;
        questions.forEach((q, i) => {
          if (answers[i] === q.answer) score++;
        });
        showResultPage(score);
        window.scrollTo({ top: 0, behavior: "smooth" });
      }

      function tryAgain() {
        const area = document.getElementById("questionArea");
        area.style.transition = "opacity 0.3s ease, transform 0.3s ease";
        area.style.opacity = "0";
        area.style.transform = "translateY(-20px)";

        setTimeout(() => {
          current = 0;
          answers = new Array(questions.length).fill(null);
          remaining = 2 * 60 * 60;

          clearInterval(timerInterval);
          timerInterval = setInterval(updateTimer, 1000);

          document.getElementById("navPanel").classList.remove("hide");

          loadNav();
          showQuestion(0);

          setTimeout(() => {
            area.style.opacity = "1";
            area.style.transform = "translateY(0)";
          }, 50);

          window.scrollTo({ top: 0, behavior: "smooth" });
        }, 300);
      }
    </script>
  </body>
</html>
